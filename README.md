# Flutter Chat Composer

>How about transforming your state machine in a chat bot? Flutter Chat Composer makes use of state machines generated by <a href="https://github.com/FelipeMarra/state-composer">state_composer<a> to create chatbots based on those states

# Usage

## Creating the chat's state machine

A chat bot is composed of states. Let's recreate a simple one that's in our example folder. <br>
First we'll declare our initial state and functions that we use to create our states isoladed:

``` dart 
ChatBot(
    id: "myChatBot",
    initialStateId: "A",
    states: [
    _stateA(),
    _stateB(),
    _stateC(),
    _stateD(),
    _stateE(),
    ],
);
```
### State Types and Properties
First you should now general state properties. They will have the id and onEnter/onLeave functions, like in  <a href="https://github.com/FelipeMarra/state-composer">state_composer<a>, and generally something to show to the user and receives it's input in return.<br>
    
Currently we have 4 state types, let's add one of each in our bot.<br>

### Open Text State

State A will intruduce our bot to the user, and ask his name back. As you can see a text state type has a decideTransition propertie, wich will give you the text typed by the user so you can decide what transition to make. In our <a href="https://github.com/FelipeMarra/flutter_chat_composer/tree/main/example"  width="360" height="240">example<a> will run _stateADecision wich will say to our machine to transition to the state ALoop till the user say his name. When the text is not empty will go to state B.

``` dart 

  String _stateADecision(TextEditingController textController) {
    if (textController.text.isEmpty) {
      return "ALoop";
    } else {
      userName = textController.text;
      return "B";
    }
  }

  BotStateOpenText _stateA() {
    return BotStateOpenText(
      id: "A",
      messages: () => [
        Text.rich(
          TextSpan(
            children: [
              const TextSpan(text: "Hi, I'm "),
              TextSpan(
                children: [
                  TextSpan(
                      text: botName,
                      style: const TextStyle(
                        fontWeight: FontWeight.bold,
                      )),
                ],
              ),
              const TextSpan(
                children: [
                  TextSpan(text: ", what is your name ?"),
                ],
              ),
            ],
          ),
        ),
      ],
      transitions: [
        BotTransition(id: "A=>ALoop", to: "ALoop"),
        BotTransition(id: "A=>B", to: "B"),
      ],
      decideTransition: _stateADecision,
    );
  }

  BotStateOpenText _stateALoop() {
    return BotStateOpenText(
      id: "ALoop",
      messages: () => [
        const Text.rich(
          TextSpan(
            children: [
              TextSpan(text: "I reaally nedd to know your name... "),
            ],
          ),
        ),
      ],
      transitions: [
        BotTransition(id: "ALoop=>ALoop", to: "ALoop"),
        BotTransition(id: "ALoop=>B", to: "B"),
      ],
      decideTransition: (textController) {
        if (textController.text.isEmpty) {
          return "ALoop";
        } else {
          userName = textController.text;
          return "B";
        }
      },
    );
  }
```

<img src="https://media.giphy.com/media/mnLsC3qgROE4ClDiBb/giphy.gif" />


## Creating the UI

UI is created using the `ChatBotWidget`, it already comes with predefined widgets to show everything you need, but you can customize all of them.

``` dart 
class ChatBotInteractionApp extends StatelessWidget {
  const ChatBotInteractionApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    ChatBot chatBot = MyChatBot().chatBot();
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(
          title: const Text("My ChatBot"),
          centerTitle: true,
        ),
        body: ChatBotWidget(
          chatBot: chatBot,
          sameUserSpacing: 3,
        ),
      ),
    );
  }
}
```
The parametters are:

...
